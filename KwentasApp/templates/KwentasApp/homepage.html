{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="x-icon" href="{% static 'KwentasApp/img/logobrowser.jpg' %}">
    <title>Kwentas Klaras - Home</title>
    <!-- Font Awesome CDN-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <!-- Stylesheet -->
    <link rel="stylesheet" href="{% static 'KwentasApp/css/homepage.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <section>
      <div class="navbar">
        <div class="navbar-brand">
            <span>Kwentas Klaras Digital PMIS v1.0</span>
            <div id="datetime" class="datetime-display"></div>
        </div>
    </div>
      <div class="row">
        <div class="column">
          <div class="card">
            <div class="icon-wrapper">
              <i class="fas fa-project-diagram"></i>
            </div>
            <h3>PPA under 20% Local Development Fund</h3>
            <p>
              <form action="{% url 'continuing_projects' %}" method="get" onsubmit="showLoadingAlert(event)">
                <button type="submit" class="btn"><i class="fas fa-table"></i> Continuing</button>
              </form>
              <form action="{% url 'ongoing_projects' %}" method="get" onsubmit="showLoadingAlert(event)">
                <button type="submit" class="btn"><i class="fas fa-table"></i> Current </button>
              </form>
              {% if request.user.is_superuser %}
              <form action="{% url 'adddata' %}" method="get">
                <button type="submit" class="btn"><i class="fas fa-search"></i> Add Data</button>
              </form>
              {% endif %}
            </p>
          </div>
        </div>
        <div class="column">
          <div class="card">
            <div class="icon-wrapper">
              <i class="fas fa-money-bill-alt"></i>
            </div>
            <h3>PROCUREMENTS</h3>
            <p>
              View all appropriations.
            </p>
          </div>
        </div>
        <div class="column">
          <div class="card">
            <div class="icon-wrapper">
              <i class="fas fa-money-check-alt"></i>
            </div>
            <h3>OBLIGATIONS / DISBURSEMENTS</h3>
            <form action="" method="get">
              <button type="submit" class="btn">Obligations</button>
            </form>
         
              <form action="" method="get">
                <button type="submit" class="btn">Disbursement</button>
              </form>
              <form action="" method="get">
                <button type="submit" class="btn">Check Payment</button>
              </form>
             
          
          
          </div>
        </div>
        <div class="column">
          <div class="card">
            <div class="icon-wrapper">
              <i class="fas fa-eye"></i>
            </div>
            <h3>MONITORING & EVALUATION</h3>
            <p>
              Monitor and evaluate existing projects.
            </p>
          </div>
        </div>


        <div class="column">
            <div class="card">
              <div class="icon-wrapper">
                <i class="fas fa-chart-line"></i>
              </div>
              <h3>REPORTS</h3>
              
        
          <a href="{% url 'reports' %}"  onclick="showLoadingAlertReports(event)"  style="text-decoration: none;"> <button type="button" class="btn">Dashboard</button></a>

          <a href="{% url 'all_projects' %}"  onclick="showLoadingAlertReports(event)"  style="text-decoration: none;"> <button type="button" class="btn">Project Reports</button></a>
          
            </div>
          
        </div>


        <div class="column">
          <div class="card">
            <div class="icon-wrapper">
              <i class="fas fa-person"></i>
            </div>
            <h3>Logged in as {{ user_name }}</h3>
            <p>
              {% if user.is_superuser %}
              <form action="{% url 'admin:index' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn"><i class="fas fa-person"></i> Admin</button>
              </form>
              {% endif %}
              {% if user.is_superuser %}
              <form action="{% url 'register' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn"><i class="fas fa-add"></i> Add Account</button>
              </form>
              {% endif %}
              <form action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
              </form>
            </p>
          </div>
        </div>
      </div>
    </section>
    <script>
      function showLoadingAlert(event) {
        event.preventDefault(); // Prevent the form from submitting immediately
    
        Swal.fire({
            title: 'Loading...',
            text: 'Fetching data from realtime database.',
            html: `
                <div style="display: flex; justify-content: center; align-items: center;">
                    <img src="{% static 'KwentasApp/img/download.gif' %}" style="width: 100px; height: 100px;" />
                </div>
                <p>Fetching data from database.</p>
            `,
            allowOutsideClick: false,
            showConfirmButton: false
        });
    
        sessionStorage.setItem('showingSweetAlert', 'true');
    
        setTimeout(() => {
          event.target.submit();
        }, 500);
      }
    
      window.addEventListener('pageshow', function () {
        if (sessionStorage.getItem('showingSweetAlert') === 'true') {
          Swal.close();
          sessionStorage.removeItem('showingSweetAlert');
        }
      });

      document.addEventListener('DOMContentLoaded', function () {
        const body = document.querySelector('body');
        body.classList.add('page-loaded');

        // Update date and time
        function updateDateTime() {
          const now = new Date();
          const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          const day = days[now.getDay()];
          const date = now.toLocaleDateString();
          const time = now.toLocaleTimeString();
          document.getElementById('datetime').textContent = `${day}, ${date} - ${time}`;
        }

        updateDateTime();
        setInterval(updateDateTime, 1000); // Update every second
      });
      </script>

      {% if request.session.just_logged_in %}
      <script>
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3700,
        timerProgressBar: true,
        didOpen: (toast) => {
          toast.onmouseenter = Swal.stopTimer;
          toast.onmouseleave = Swal.resumeTimer;
        },
        customClass: {
          container: 'custom-toast-container'
        }
      });

      function showWelcomeMessage(userName) {
        const now = new Date();
        const hours = now.getHours();
        let greeting = '';
        if (hours >= 5 && hours < 12) {
          greeting = 'Good Morning';
        } else if (hours >= 12 && hours < 18) {
          greeting = 'Good Afternoon';
        } else {
          greeting = 'Good Evening';
        }

        Toast.fire({
          icon: 'success',
          title: `${greeting}, Welcome to Kwentas Klaras`,
          text: `${userName}`
        });
      }

      function updateClock() {
        const now = new Date();
        const timeElement = document.getElementById('clock');
        timeElement.textContent = now.toLocaleTimeString();
      }

      window.addEventListener('DOMContentLoaded', () => {
        const userName = '{{ request.user.name }}';
        showWelcomeMessage(userName);
        fetch("{% url 'unset_just_logged_in' %}");
        setInterval(updateClock, 1000);
      });
    </script>
    {% endif %}
    <style>
      .green-btn {
        background-color: #00AB66 !important;
        border: none !important;
        box-shadow: none !important;
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background-color: #007FFF; /* Adjust background color as needed */
        color: #fff; /* Adjust text color as needed */
      }

      .navbar-left {
        flex: 1;
      }

      .navbar-right {
        flex: 1;
        text-align: right;
      }

      .datetime-display {
        font-size: 14px;
        color: #fff; /* Adjust color as needed */
      }
    </style>
    <script>
      function showLoadingAlertReports(event) {
        event.preventDefault();
        Swal.fire({
          html: `
              <h2>Generating Report from database</h2>
              <div style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
                <img src="{% static 'KwentasApp/img/printer.gif' %}" style="width: 100px; height: 100px; margin-bottom: 35px" />
              </div>
              <p>Fetching data from database.</p>
          `,
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => {
              sessionStorage.setItem('showingSweetAlert', 'true');
          }
        });

        const link = event.currentTarget;
        setTimeout(() => {
          window.location.href = link.href;
        }, 500);
      }

      function handlePageShow(event) {
        if (sessionStorage.getItem('showingSweetAlert') === 'true') {
          Swal.close();
          sessionStorage.removeItem('showingSweetAlert');
        }
      }

      document.getElementById('reports-link').addEventListener('click', showLoadingAlert);
      window.addEventListener('pageshow', handlePageShow);
      window.addEventListener('popstate', function () {
        if (sessionStorage.getItem('showingSweetAlert') === 'true') {
          sessionStorage.removeItem('showingSweetAlert');
        }
      });
    </script>
  </body>
</html>
